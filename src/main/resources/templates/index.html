<!DOCTYPE html>
<html lang="en" xmlns:th = "http://www.thymeleaf.org">
    <head>
        <meta
                name="viewport"
                content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
        />

        <link
                rel="stylesheet"
                href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.css"
        />

        <meta http-equiv="X-UA-Compatible" content="ie=edge"/>

        <meta charset="UTF-8">
        <title>Home</title>

        <!--  This span is filled with <link> tags for css files!  -->
        <span>
        <!--  This span contains the css files for the navigation /desktop and mobile/  -->
            <span id = "navigation-css"></span>
            <link rel="stylesheet" href="/css/styles/style.css" >
            <link href="/css/styles/desktop-pages-with-form-style.css" rel="stylesheet">
            <link href="/css/styles/filters-styles.css" rel="stylesheet">
            <script src="https://kit.fontawesome.com/09640ec319.js" crossorigin="anonymous"></script>
            <link href="/css/styles/index-page-styles.css" rel="stylesheet">
        </span>

        <!--  This span is filled with <script> tags for JavaScript files!  -->
        <span>
            <script src="/js/scripts/navigation-script.js" type="module"></script>
        </span>

    </head>

    <body>

    <span th:insert = "~{fragments/navbar}"></span>

    <div th:if = "${@loggedUser.isNotLoggedIn()}" class = "welcome-index-div">
        <img src = "/images/welcome-image.jpg" alt="" class = "welcome-image">
        <center>
            <h1 class = "welcome-header">Welcome to AutoDeluxe!</h1>
            <h3>Please Login</h3>
        </center>
    </div>

    <span th:if = "${@loggedUser.isLoggedIn()}" class="main-page">

            <div class="filter-box">

                <form class="filter-form">
                    <div class="form__group field">
                        <p class="filter-header">Make</p>
                        <div class="select">
                            <select id="make" name="make" class="form__select" aria-describedby="categoryHelpInline">
                                <option value="" selected disabled>Make</option>
                                <option>Ford</option>
                                <option>Chevrolet</option>
                                <option>Peugeot</option>
                                <option>Renault</option>
                                <option>Dodge</option>
                                <option>Toyota</option>
                            </select>
                        </div>
                    </div>

                    <div class="form__group field">
                        <p class="filter-header">Model</p>
                        <div class="select">
                            <select id="model" name="model" class="form__select" aria-describedby="categoryHelpInline">
                                <option value="" selected disabled>Model</option>
                                <option>Fiesta</option>
                                <option>Focus</option>
                                <option>Mustang</option>
                                <option>Camaro</option>
                                <option>Challenger</option>
                                <option>Charger</option>
                                <option>Supra</option>
                                <option>Corolla</option>
                            </select>
                        </div>
                    </div>

                    <div class="form__group field">
                        <input type="date" class="form__field" placeholder="year" name="year"
                               id='year'/>
                        <label for="year" class="form__label">Year</label>
                    </div>

                    <button type="submit" class="filter-button btn">
                        Filter
                    </button>
                </form>

            </div>

            <div class="car-offers">
<!--                <div th:each = "car : ${cars}">-->
<!--                    <div class="offer">-->
<!--                        <img th:src="@{'data:image;base64,' + car.imageData}" alt="" class="offer-image">-->
<!--                        <h3 class="offer-header" th:text = "${car.make} + ' ' ${car.model} + ' ' ${car.series}"></h3>-->
<!--                        <h3 class="offer-price" th:text="${car.price} + ' euro'"></h3>-->
<!--                        <p class = "offer-description" th:text="${car.description}"></p>-->
<!--                        <button class = "offer-button btn" th:href = "@{/car/car.id}">Go To Offer</button>-->
<!--                    </div>-->
<!--                </div>-->
            </div>
        </span>


    <script th:type="module">
        // Make a request to your REST API
        fetch('/api/cars')
            .then(response => response.json())
            .then(data => {
                // Get a reference to the container where you want to display the data
                const offerContainer = document.querySelector('.car-offers');

                // Loop through the data and create an element for each car
                data.forEach(car => {
                    // Create a new div element for the car
                    const offerDiv = document.createElement('div');
                    offerDiv.className = 'offer';

                    // Create an image element for the car's photo
                    const image = document.createElement('img');
                    image.src = `data:${car.imageType};base64,${car.image}`;
                    image.className = "offer-image"
                    offerDiv.appendChild(image);

                    // Create a heading for the car's make and model
                    const heading = document.createElement('h3');
                    heading.textContent = `${car.make} ${car.model} ${car.series}`;
                    heading.className = "offer-header"
                    offerDiv.appendChild(heading);

                    // Create a heading for the car's price
                    const price = document.createElement('h3');
                    price.textContent = `${car.price} euro`;
                    price.className = "offer-price"
                    offerDiv.appendChild(price);

                    // Create a heading for the car's condition
                    const condition = document.createElement("h2");
                    condition.textContent = `${car.condition}`;
                    condition.className = "offer-condition";
                    offerDiv.appendChild(condition);

                    // Create a paragraph element for the car's description
                    const description = document.createElement('p');
                    description.textContent = car.description;
                    description.className = "offer-description"
                    offerDiv.appendChild(description);

                    // Create a button for the offer
                    const button = document.createElement("a");
                    button.textContent = "Go To Offer";
                    button.classList.add("btn");
                    button.classList.add("offer-button");
                    button.setAttribute("th:href", `@{/car/${car.id}`)

                    // Add the new car div to the container
                    offerContainer.appendChild(offerDiv);
                });
            })
            .catch(error => console.error(error));
    </script>
    </body>
</html>